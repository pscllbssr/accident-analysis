---
title: "Analysis"
author: ""
output: html_document
date: "2023-01-30"
---

# Loading the datasets

## accidents

Load the accidents dataset, already downloaded. 
Source: https://data.geo.admin.ch/ch.astra.unfaelle-personenschaeden_alle/

```{r setup}
library(data.table)

accidents_df <- data.frame(fread("data/RoadTrafficAccidentLocations.csv"))
columns <- c("AccidentUID", "AccidentType", "AccidentType_en", "AccidentSeverityCategory", "AccidentSeverityCategory_en", "AccidentInvolvingPedestrian", "AccidentInvolvingBicycle", "AccidentInvolvingMotorcycle", "RoadType", "RoadType_en", "AccidentLocation_CHLV95_E", "AccidentLocation_CHLV95_N", "CantonCode", "MunicipalityCode", "AccidentYear", "AccidentMonth", "AccidentWeekDay", "AccidentHour", "AccidentWeekDay_en")
accidents_df <- accidents_df[columns]
head(accidents_df)
```





```

# Analysis

load libs
```{r, echo=FALSE}
library(ggplot2)
library(magrittr)
library(tidyverse)
library(dplyr)
```

```{r, echo=FALSE}

accidents_df %>% 
  group_by(AccidentYear) %>% 
  summarise(Count = n()) %>% 
  ggplot(mapping = aes(x = AccidentYear, y = Count, fill = AccidentYear)) +
  geom_bar(stat = "identity") + 
  labs(title = "Accidents per year",
       x = "Year",
       y = "Nr. of accidents")
  
```

```{r, echo=FALSE}

accidents_df %>% 
  group_by(AccidentMonth) %>% 
  summarise(Count = n()) %>% 
  ggplot(mapping = aes(x = factor(AccidentMonth), y = Count, fill = Count)) +
  geom_bar(stat = "identity") + 
  scale_fill_continuous(type = "gradient", trans = "reverse") +
  scale_x_discrete() +
  labs(title = "Most accidents happen in the summer",
       x = "Month",
       y = "Nr. of accidents")
  
```
Maybe because tourists travel through switzerland in summer? have a look at accidents on main roads in summer

```{r }
unique(accidents_df$RoadType_en)
```

```{r, echo=FALSE}

accidents_df %>% 
  group_by(AccidentMonth, RoadType_en) %>% 
  summarise(Count = n()) %>% 
  arrange(.,desc(Count)) %>% 
  ggplot(mapping = aes(x = factor(AccidentMonth), y = Count)) +
  geom_bar(stat = "identity") +
  facet_wrap( ~ RoadType_en) +
  scale_x_discrete() +
  labs(title = "Accidents per road type during the year",
       x = "Month",
       y = "Nr. of accidents")
  
```

Analyse Weekdays/Hours

````{r heatmap_of_accidents, echo = FALSE}

accidents_df[,c("AccidentUID", "AccidentWeekDay", "AccidentHour")] %>%
  group_by(AccidentWeekDay, AccidentHour) %>% 
  summarise(Count = n()) %>% 
  mutate(AccidentWeekDay_f=factor(x = AccidentWeekDay,levels = rev(c("aw401", "aw402", "aw403", "aw404", "aw405", "aw406", "aw407"
)), labels = rev(c("Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday")))) %>% 
  # pull(AccidentWeekDay_f) %>% levels() %>% dput
  ggplot(aes(x = AccidentHour, y = AccidentWeekDay_f, fill = Count)) +
    geom_raster() +
    labs(x = 'Hour', y = "Day of  the Week", title = "Most Accidents happen on weekdays in the evening") +
    theme_minimal()

````

````{r map_of_accidents, echo = FALSE}

accidents_df[,c("AccidentLocation_CHLV95_E", "AccidentLocation_CHLV95_N", "RoadType_en")] %>%
  ggplot(aes(x = AccidentLocation_CHLV95_E, y = AccidentLocation_CHLV95_N, colour = RoadType_en)) +
    geom_point(alpha = 0.1) +
    labs(x = 'E', y = "N", title = "Map of accidents") +
    theme_minimal() +
    guides(colour = guide_legend(override.aes = list(alpha = 1))) +
    coord_fixed()

````


````{r map_of_accidents, echo = FALSE}

accidents_df[,c("AccidentLocation_CHLV95_E", "AccidentLocation_CHLV95_N", "AccidentWeekDay")] %>%
  ggplot(aes(x = AccidentLocation_CHLV95_E, y = AccidentLocation_CHLV95_N, colour = AccidentWeekDay %in% c("aw406", "aw407"))) +
    geom_point(alpha = 0.1) +
    labs(x = 'E', y = "N", title = "Map of accidents", colour = "Day") +
    scale_color_discrete(labels=c('Weekday', 'Weekend')) +
    theme_minimal() +
    guides(colour = guide_legend(override.aes = list(alpha = 1))) +
    coord_fixed()

````

lorem ipsum

`````{r }
sort(unique(accidents_df$AccidentWeekDay), decreasing = FALSE)


`````
Thanks, bye!